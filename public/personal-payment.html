<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>å€‹äººç¹³è²»ç´€éŒ„</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container py-4">
        <h3 class="mb-3">ğŸ“‘ æˆ‘çš„ç¹³è²»ç´€éŒ„</h3>

        <p class="mb-3">
            <span class="fw-bold">å­¸è™Ÿï¼š</span>
            <span id="mySid" class="text-primary"></span>
        </p>

        <table class="table table-bordered bg-white align-middle">
            <thead class="table-light">
                <tr>
                    <th>è²»ç”¨åç¨±</th>
                    <th>é‡‘é¡</th>
                    <th>æœŸé™</th>
                    <th>ç‹€æ…‹</th>
                </tr>
            </thead>
            <tbody id="payBody"></tbody>
        </table>

        <button id="backBtn" class="btn btn-secondary">è¿”å›</button>
    </div>

    <script type="module">
        import { apiGet, fmt, getClubId } from './finance-common.js';

        const sid = localStorage.getItem('studentId');
        if (!sid) { alert('è«‹å…ˆç™»å…¥'); location.href = 'login.html'; }

        const clubId = getClubId();                       // â† ç›®å‰ç¤¾åœ˜
        document.getElementById('mySid').textContent = sid;
        const payBody = document.getElementById('payBody');

        /* åªæ’ˆæœ¬ç¤¾åœ˜ ------------------------------------------------------ */
        async function load() {
            const list = await apiGet(`/members/${sid}/payments?club_id=${clubId}`);
            payBody.innerHTML = list.length
                ? list.map(l => `
            <tr>
              <td>${l.name}</td>
              <td>${l.amount}</td>
              <td>${fmt(l.deadline)}</td>
              <td class="${l.status === 'å·²ç¹³' ? 'text-success'
                        : l.status === 'é€¾æœŸ' ? 'text-danger'
                            : 'text-warning'}">${l.status}</td>
            </tr>`).join('')
                : `<tr><td colspan="4" class="text-center text-muted">æ­¤ç¤¾åœ˜å°šç„¡éœ€ç¹³è²»ç”¨</td></tr>`;
        }
        load();

        /* è¿”å› club.html -------------------------------------------------- */
        document.getElementById('backBtn').onclick =
            () => window.location.href = `club.html?clubId=${clubId}`;
    </script>
</body>

</html>